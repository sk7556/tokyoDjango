{% extends 'base_generic.html' %}

{% block styles %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/post_list.css' %}">
{% endblock %}

{% block content %}

<div class="text-right mb-3">
  <a href="{% url 'diary:post_new' %}" class="btn btn-primary">글 쓰기</a>
</div>

<table>
  <thead>
    <tr>
      <th>Num</th>
      <th>제목</th>
      <th>작성일, 시</th>
      <th>삭제</th>
    </tr>
  </thead>
  <tbody>
    {% for post in posts %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td><a href="{% url 'diary:post_detail' pk=post.pk %}">{{ post.title }}</a></td>
      <td>{{ post.created_at }}</td>
      <td>
        <form id="deleteForm{{ forloop.counter }}" action="{% url 'diary:post_delete' pk=post.pk %}" method="post">
          {% csrf_token %}
          <input type="submit" value="삭제" class="delete-btn" data-id="{{ forloop.counter }}">
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 사용자 인증 상태 확인
    var isAuthenticated = {{ user.is_authenticated|lower }};

    // 삭제 버튼 클릭 시 confirm 창 표시
    var deleteBtns = document.querySelectorAll('.delete-btn');
    deleteBtns.forEach(function(btn) {
        btn.addEventListener('click', function(event) {
            var postId = event.target.dataset.id;
            if (!isAuthenticated) {
                event.preventDefault();
                alert('로그인이 필요합니다.');
            } else {
                if (!confirm('정말로 삭제하시겠습니까?')) {
                    event.preventDefault();
                } else {
                    document.getElementById('deleteForm' + postId).submit();
                }
            }
        });
    });
});
</script>

{% endblock %}
