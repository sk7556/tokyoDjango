{% extends 'base_generic.html' %}

{% block title %}남정식 이력서{% endblock %}

{% block styles %}{% load static %}<link rel="stylesheet" href="{% static 'css/resume.css' %}">{% endblock %}
{% block headerJS %}
<script src="https://cdn.jsdelivr.net/npm/showdown/dist/showdown.min.js"></script>
{% endblock %}

{% block content %}
<section class="resume-section">
    <div class="container">
        <div class="row">
            <div class="col-md-3">
                <img src="{{ resume.photo.url }}" alt="Your Photo" class="img-fluid rounded-circle" style="max-width: 150px; height: auto;">
            </div>
            <div class="col-md-9">
                <!-- Update Button -->
                <button id="updateButton">이력서 수정</button>
                <div class="item" id="comment">
                    <p>{{ resume.comment | safe }}</p>
                </div>
                <div class="item name_role">
                    <h3 id="name">이름 : {{ resume.name | safe }}</h3>
                    <p id="role">지원분야: {{ resume.role | safe }}</p>
                </div>
                
                <div class="item" id="career">
                    <p>{{ resume.career | safe }}</p>
                </div>

                <div class="item" id="salary">
                    <p>연봉: {{ resume.salary | safe }}</p>
                </div>
                <div class="item" id="intro">
                    <p>자기 소개: {{ resume.intro | safe }}</p>
                </div>
                <div class="item" id="information">
                    <p>개인 정보: {{ resume.information | safe }}</p>
                </div>
                <div class="item" id="certificate">
                    <p>보유 자격: {{ resume.certificate | safe }}</p>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block scripts %}  
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var token = localStorage.getItem('access_token');
        var updateButton = document.getElementById('updateButton');
    
        if (token) {
            updateButton.addEventListener('click', function() {
                fetch('{% url 'resume:update_resume' %}', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                })
                .then(response => {
                    if (response.ok) {
                        window.location.href = '{% url 'resume:update_resume' %}';
                    } else {
                        alert('토큰이 유효하지 않습니다.');
                    }
                })
                .catch(error => {
                    console.error('에러 발생:', error);
                    alert('요청을 처리하는 중에 오류가 발생했습니다.');
                });
            });
        } else {
            updateButton.addEventListener('click', function() {
                alert('로그인 된 사용자만 사용 가능합니다.');
            });
        }
    });
    
</script>
{% endblock %}
